// Translations for reservation page
const reservationTranslations = {
  pt: {
    // Navigation
    aboutUs: "Sobre nós",
    restaurants: "Restaurantes",
    location: "Localização",
    faq: "FAQ",
    backToSite: "Voltar ao Site",

    // Reservation Form
    reservationTitle: "Faça sua Reserva",
    reservationSubtitle: "Reserve seu lounge ou área com piscina em nossos restaurantes. AVISO: Para reservas no mesmo dia, só é possível reservar até as 10h da manhã.",
    validationMessage: "Por favor, preencha todos os campos obrigatórios",

    // Form Labels
    fullNameLabel: "Nome Completo *",
    phoneLabel: "Telefone *",
    emailLabel: "E-mail *",
    guestsLabel: "Número de Pessoas *",
    restaurantLabel: "Restaurante *",
    reservationTypeLabel: "Tipo de Reserva *",
    dateLabel: "Data *",
    timeLabel: "Horário *",
    occasionLabel: "Ocasião",
    observationsLabel: "Observações Especiais",

    // Select Options
    selectOption: "Selecione",
    onePerson: "1 pessoa",
    twoPeople: "2 pessoas",
    threePeople: "3 pessoas",
    fourPeople: "4 pessoas",
    fivePeople: "5 pessoas",
    sixPeople: "6 pessoas",
    sevenPeople: "7 pessoas",
    eightPeople: "8 pessoas",
    ninePeople: "9 pessoas",
    tenPeople: "10 pessoas",
    moreThanTen: "Mais de 10 pessoas",

    selectRestaurant: "Selecione o restaurante",
    selectRestaurantFirst: "Primeiro selecione o restaurante",
    selectTime: "Selecione o horário",
    selectOptional: "Selecione (opcional)",

    // Occasions
    birthday: "Aniversário",
    romanticDate: "Encontro Romântico",
    familyReunion: "Reunião de Família",
    friendsMeeting: "Encontro de Amigos",
    celebration: "Comemoração",
    businessMeeting: "Reunião de Trabalho",
    other: "Outro",

    // Placeholders
    observationsPlaceholder: "Alguma observação especial? (opcional)",

    // Actions
    copyInstruction: "Primeiro copie os dados da reserva",
    copyDataButton: "Copiar Dados da Reserva",
    whatsappInstruction: "Agora envie pelo WhatsApp",
    whatsappButton: "Enviar pelo WhatsApp",

    // Messages
    dataCopied: "Dados Copiados!",
    copyError: "Erro ao copiar os dados. Por favor, tente novamente.",
    requiredFields: "Campos obrigatórios:",
    notInformed: "Não informado",
    noSpecialObservations: "Nenhuma observação especial",
  },

  en: {
    // Navigation
    aboutUs: "About Us",
    restaurants: "Restaurants",
    location: "Location",
    faq: "FAQ",
    backToSite: "Back to Site",

    // Reservation Form
    reservationTitle: "Make Your Reservation",
    reservationSubtitle: "Reserve your lounge or pool area at our restaurants. WARNING: For same-day reservations, it is only possible to book until 10:00 a.m.",
    validationMessage: "Please fill in all required fields",

    // Form Labels
    fullNameLabel: "Full Name *",
    phoneLabel: "Phone *",
    emailLabel: "E-mail *",
    guestsLabel: "Number of People *",
    restaurantLabel: "Restaurant *",
    reservationTypeLabel: "Reservation Type *",
    dateLabel: "Date *",
    timeLabel: "Time *",
    occasionLabel: "Occasion",
    observationsLabel: "Special Observations",

    // Select Options
    selectOption: "Select",
    onePerson: "1 person",
    twoPeople: "2 people",
    threePeople: "3 people",
    fourPeople: "4 people",
    fivePeople: "5 people",
    sixPeople: "6 people",
    sevenPeople: "7 people",
    eightPeople: "8 people",
    ninePeople: "9 people",
    tenPeople: "10 people",
    moreThanTen: "More than 10 people",

    selectRestaurant: "Select the restaurant",
    selectRestaurantFirst: "First select the restaurant",
    selectTime: "Select the time",
    selectOptional: "Select (optional)",

    // Occasions
    birthday: "Birthday",
    romanticDate: "Romantic Date",
    familyReunion: "Family Reunion",
    friendsMeeting: "Friends Meeting",
    celebration: "Celebration",
    businessMeeting: "Business Meeting",
    other: "Other",

    // Placeholders
    observationsPlaceholder: "Any special observation? (optional)",

    // Actions
    copyInstruction: "First copy the reservation data",
    copyDataButton: "Copy Reservation Data",
    whatsappInstruction: "Now send via WhatsApp",
    whatsappButton: "Send via WhatsApp",

    // Messages
    dataCopied: "Data Copied!",
    copyError: "Error copying data. Please try again.",
    requiredFields: "Required fields:",
    notInformed: "Not informed",
    noSpecialObservations: "No special observations",
  },

  es: {
    // Navigation
    aboutUs: "Sobre Nosotros",
    restaurants: "Restaurantes",
    location: "Ubicación",
    faq: "FAQ",
    backToSite: "Volver al Sitio",

    // Reservation Form
    reservationTitle: "Haz tu Reserva",
    reservationSubtitle: "Reserve su lounge o área con piscina en nuestros restaurantes. AVISO: Para reservas en el mismo día, solo es posible reservar hasta las 10:00 de la mañana.",
    validationMessage: "Por favor, completa todos los campos obligatorios",

    // Form Labels
    fullNameLabel: "Nombre Completo *",
    phoneLabel: "Teléfono *",
    emailLabel: "E-mail *",
    guestsLabel: "Número de Personas *",
    restaurantLabel: "Restaurante *",
    reservationTypeLabel: "Tipo de Reserva *",
    dateLabel: "Fecha *",
    timeLabel: "Horario *",
    occasionLabel: "Ocasión",
    observationsLabel: "Observaciones Especiales",

    // Select Options
    selectOption: "Seleccionar",
    onePerson: "1 persona",
    twoPeople: "2 personas",
    threePeople: "3 personas",
    fourPeople: "4 personas",
    fivePeople: "5 personas",
    sixPeople: "6 personas",
    sevenPeople: "7 personas",
    eightPeople: "8 personas",
    ninePeople: "9 personas",
    tenPeople: "10 personas",
    moreThanTen: "Más de 10 personas",

    selectRestaurant: "Selecciona el restaurante",
    selectRestaurantFirst: "Primero selecciona el restaurante",
    selectTime: "Selecciona el horario",
    selectOptional: "Seleccionar (opcional)",

    // Occasions
    birthday: "Cumpleaños",
    romanticDate: "Cita Romántica",
    familyReunion: "Reunión Familiar",
    friendsMeeting: "Encuentro de Amigos",
    celebration: "Celebración",
    businessMeeting: "Reunión de Trabajo",
    other: "Otro",

    // Placeholders
    observationsPlaceholder: "¿Alguna observación especial? (opcional)",

    // Actions
    copyInstruction: "Primero copia los datos de la reserva",
    copyDataButton: "Copiar Datos de la Reserva",
    whatsappInstruction: "Ahora envía por WhatsApp",
    whatsappButton: "Enviar por WhatsApp",

    // Messages
    dataCopied: "¡Datos Copiados!",
    copyError: "Error al copiar los datos. Por favor, inténtalo de nuevo.",
    requiredFields: "Campos obligatorios:",
    notInformed: "No informado",
    noSpecialObservations: "Sin observaciones especiales",
  },
}

// Current language
let currentReservationLanguage = localStorage.getItem("preferredLanguage") || "pt"

// Language management functions
function detectUserLanguage() {
  const userLanguage = navigator.language || navigator.userLanguage
  return userLanguage.split("-")[0].toLowerCase()
}

function changeReservationLanguage(lang) {
  currentReservationLanguage = lang
  localStorage.setItem("preferredLanguage", lang)

  const currentFlag = document.getElementById("currentFlag")
  const flagMap = {
    pt: "br",
    en: "us",
    es: "es",
  }
  currentFlag.src = `https://flagcdn.com/w20/${flagMap[lang]}.png`

  translateReservationPage()
}

function translateReservationPage() {
  const elementsToTranslate = document.querySelectorAll("[data-translate]")

  elementsToTranslate.forEach((element) => {
    const key = element.getAttribute("data-translate")
    if (
      reservationTranslations[currentReservationLanguage] &&
      reservationTranslations[currentReservationLanguage][key]
    ) {
      element.innerHTML = reservationTranslations[currentReservationLanguage][key]
    }
  })

  // Update placeholders
  const observationsTextarea = document.getElementById("observations")
  if (observationsTextarea && reservationTranslations[currentReservationLanguage].observationsPlaceholder) {
    observationsTextarea.placeholder = reservationTranslations[currentReservationLanguage].observationsPlaceholder
  }
}

function setupReservationLanguageSelector() {
  const languageToggle = document.getElementById("languageToggle")
  const languageDropdown = document.getElementById("languageDropdown")
  const languageOptions = document.querySelectorAll(".language-option")

  languageToggle.addEventListener("click", (e) => {
    e.stopPropagation()
    languageDropdown.classList.toggle("active")
  })

  document.addEventListener("click", () => {
    languageDropdown.classList.remove("active")
  })

  languageOptions.forEach((option) => {
    option.addEventListener("click", (e) => {
      e.stopPropagation()
      const lang = option.getAttribute("data-lang")
      changeReservationLanguage(lang)
      languageDropdown.classList.remove("active")
    })
  })
}

document.addEventListener("DOMContentLoaded", () => {
  const reservationForm = document.getElementById("reservationForm")
  const copyDataBtn = document.getElementById("copyDataBtn")
  const whatsappBtn = document.getElementById("whatsappBtn")
  const whatsappInstruction = document.querySelector(".whatsapp-instruction")
  const validationMessage = document.getElementById("validationMessage")
  const restaurantSelect = document.getElementById("restaurant")
  const reservationTypeSelect = document.getElementById("reservationType")

  // Initialize language system
  setupReservationLanguageSelector()
  changeReservationLanguage(currentReservationLanguage)

  // Reservation types by restaurant (only restaurants that accept reservations)
  const reservationTypes = {
    "Golfinho Bar": {
      pt: ["Área com Piscina"],
      en: ["Pool Area"],
      es: ["Área con Piscina"],
    },
    "Lovina Seixas": {
      pt: ["Lounge com Jacuzzi"],
      en: ["Lounge with Jacuzzi"],
      es: ["Lounge con Jacuzzi"],
    },
    "Lovina Ponta de Campina": {
      pt: ["Lounge", "Lounge com Jacuzzi"],
      en: ["Lounge", "Lounge with Jacuzzi"],
      es: ["Lounge", "Lounge con Jacuzzi"],
    },
  }

  // Enable other fields only after restaurant selection
  const dependentFields = ["guests", "reservationType", "date", "time", "occasion"]

  // Initially disable dependent fields
  dependentFields.forEach((fieldId) => {
    const field = document.getElementById(fieldId)
    if (fieldId !== "occasion") {
      // occasion is optional
      field.disabled = true
    }
  })

  function updateReservationTypeOptions() {
    const selectedRestaurant = restaurantSelect.value

    // Clear reservation type options
    reservationTypeSelect.innerHTML = ""

    if (!selectedRestaurant) {
      const selectRestaurantFirstText = reservationTranslations[currentReservationLanguage].selectRestaurantFirst
      reservationTypeSelect.innerHTML = `<option value="">${selectRestaurantFirstText}</option>`
      reservationTypeSelect.disabled = true
      return
    }

    // Add default option
    const selectReservationTypeText = reservationTranslations[currentReservationLanguage].reservationTypeLabel.replace(
      " *",
      "",
    )
    reservationTypeSelect.innerHTML = `<option value="">${selectReservationTypeText}</option>`

    if (reservationTypes[selectedRestaurant]) {
      // Enable the select
      reservationTypeSelect.disabled = false

      // Get types in current language
      const types =
        reservationTypes[selectedRestaurant][currentReservationLanguage] || reservationTypes[selectedRestaurant].pt

      types.forEach((type) => {
        const option = document.createElement("option")
        option.value = type
        option.textContent = type
        reservationTypeSelect.appendChild(option)
      })
    }
  }

  // Restaurant selection handler
  restaurantSelect.addEventListener("change", () => {
    const selectedRestaurant = restaurantSelect.value

    // Clear and setup reservation type
    updateReservationTypeOptions()

    if (selectedRestaurant && reservationTypes[selectedRestaurant]) {
      // Enable dependent fields
      dependentFields.forEach((fieldId) => {
        document.getElementById(fieldId).disabled = false
      })
    } else {
      // Disable dependent fields
      dependentFields.forEach((fieldId) => {
        const field = document.getElementById(fieldId)
        if (fieldId !== "occasion") {
          field.disabled = true
          field.value = ""
        }
      })
    }

    checkFormValidity()
  })

  // Form validation
  const formInputs = reservationForm.querySelectorAll("input, select, textarea")

  formInputs.forEach((input) => {
    input.addEventListener("input", checkFormValidity)
    input.addEventListener("blur", validateField)
  })

  function validateField(event) {
    const field = event.target
    const isRequired = field.hasAttribute("required")

    if (isRequired && !field.value.trim()) {
      field.style.borderColor = "#dc2626"
    } else {
      field.style.borderColor = "#e5e7eb"
    }
  }

  function checkFormValidity() {
    const requiredFields = ["name", "phone", "email", "guests", "restaurant", "reservationType", "date", "time"]
    const missingFields = []
    let isValid = true

    requiredFields.forEach((fieldName) => {
      const field = document.getElementById(fieldName)
      if (!field.value.trim()) {
        isValid = false
        const label = field.previousElementSibling.textContent.replace(" *", "")
        missingFields.push(label)
      }
    })

    if (!isValid) {
      validationMessage.style.display = "block"
      const requiredFieldsText = reservationTranslations[currentReservationLanguage].requiredFields
      validationMessage.querySelector("span").textContent = `${requiredFieldsText} ${missingFields.join(", ")}`
    } else {
      validationMessage.style.display = "none"
    }

    copyDataBtn.disabled = !isValid
    return isValid
  }

  // Set minimum date to today
  const dateInput = document.getElementById("date")
  const today = new Date().toISOString().split("T")[0]
  dateInput.min = today

  // Copy reservation data
  copyDataBtn.addEventListener("click", () => {
    if (!checkFormValidity()) {
      return
    }

    const name = document.getElementById("name").value
    const phone = document.getElementById("phone").value
    const email = document.getElementById("email").value
    const guests = document.getElementById("guests").value
    const restaurant = document.getElementById("restaurant").value
    const reservationType = document.getElementById("reservationType").value
    const date = document.getElementById("date").value
    const time = document.getElementById("time").value
    const occasion =
      document.getElementById("occasion").value || reservationTranslations[currentReservationLanguage].notInformed
    const observations =
      document.getElementById("observations").value ||
      reservationTranslations[currentReservationLanguage].noSpecialObservations

    // Format date
    const formattedDate = new Date(date).toLocaleDateString(
      currentReservationLanguage === "en" ? "en-US" : currentReservationLanguage === "es" ? "es-ES" : "pt-BR",
    )

    // Create formatted text based on language
    let reservationText = ""

    if (currentReservationLanguage === "en") {
      reservationText = `
*${reservationType.toUpperCase()} RESERVATION - GRUPO FULLANO*
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👤 *Name:* ${name}
📱 *Phone:* ${phone}
📧 *E-mail:* ${email}
👥 *People:* ${guests}
🏪 *Restaurant:* ${restaurant}
🏖️ *Reservation Type:* ${reservationType}
📅 *Date:* ${formattedDate}
🕐 *Time:* ${time}
🎉 *Occasion:* ${occasion}
📝 *Observations:* ${observations}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Awaiting confirmation of my reservation! 🙏
      `.trim()
    } else if (currentReservationLanguage === "es") {
      reservationText = `
*RESERVA DE ${reservationType.toUpperCase()} - GRUPO FULLANO*
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👤 *Nombre:* ${name}
📱 *Teléfono:* ${phone}
📧 *E-mail:* ${email}
👥 *Personas:* ${guests}
🏪 *Restaurante:* ${restaurant}
🏖️ *Tipo de Reserva:* ${reservationType}
📅 *Fecha:* ${formattedDate}
🕐 *Horario:* ${time}
🎉 *Ocasión:* ${occasion}
📝 *Observaciones:* ${observations}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
¡Espero confirmación de mi reserva! 🙏
      `.trim()
    } else {
      reservationText = `
*RESERVA DE ${reservationType.toUpperCase()} - GRUPO FULLANO*
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👤 *Nome:* ${name}
📱 *Telefone:* ${phone}
📧 *E-mail:* ${email}
👥 *Pessoas:* ${guests}
🏪 *Restaurante:* ${restaurant}
🏖️ *Tipo de Reserva:* ${reservationType}
📅 *Data:* ${formattedDate}
🕐 *Horário:* ${time}
🎉 *Ocasião:* ${occasion}
📝 *Observações:* ${observations}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Aguardo confirmação da minha reserva! 🙏
      `.trim()
    }

    // Copy to clipboard
    navigator.clipboard
      .writeText(reservationText)
      .then(() => {
        const dataCopiedText = reservationTranslations[currentReservationLanguage].dataCopied
        copyDataBtn.innerHTML = `<i class="fas fa-check"></i> ${dataCopiedText}`
        copyDataBtn.style.background = "#10b981"

        // Enable WhatsApp button
        whatsappBtn.disabled = false
        whatsappInstruction.style.display = "block"

        // Reset button after 3 seconds
        setTimeout(() => {
          const copyDataButtonText = reservationTranslations[currentReservationLanguage].copyDataButton
          copyDataBtn.innerHTML = `<i class="fas fa-copy"></i> ${copyDataButtonText}`
          copyDataBtn.style.background = ""
        }, 3000)
      })
      .catch((err) => {
        const copyErrorText = reservationTranslations[currentReservationLanguage].copyError
        alert(copyErrorText)
        console.error("Erro ao copiar: ", err)
      })
  })

  // WhatsApp button
  whatsappBtn.addEventListener("click", () => {
    const whatsappNumber = "5583994086376"
    const whatsappUrl = `https://api.whatsapp.com/send/?phone=${whatsappNumber}&text&type=phone_number&app_absent=0`
    window.open(whatsappUrl, "_blank")
  })

  // Theme toggle for reservation page
  const themeToggle = document.getElementById("themeToggle")
  const themeIcon = document.getElementById("themeIcon")
  const body = document.body

  // Check for saved theme
  const savedTheme = localStorage.getItem("theme") || "light"
  if (savedTheme === "dark") {
    body.classList.add("dark-mode")
    themeIcon.className = "fas fa-moon"
  }

  // Theme toggle event
  themeToggle.addEventListener("click", () => {
    body.classList.toggle("dark-mode")

    if (body.classList.contains("dark-mode")) {
      themeIcon.className = "fas fa-moon"
      localStorage.setItem("theme", "dark")
    } else {
      themeIcon.className = "fas fa-sun"
      localStorage.setItem("theme", "light")
    }
  })

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById("mobileMenuBtn")
  const navMenu = document.getElementById("navMenu")

  if (mobileMenuBtn && navMenu) {
    mobileMenuBtn.addEventListener("click", () => {
      navMenu.classList.toggle("active")
    })
  }

  // Make updateReservationTypeOptions available globally
  window.updateReservationTypeOptions = updateReservationTypeOptions
})
